{"Name":"Pull Playbook GitSyncBeta","Integration":"GitSyncBeta","Script":"from GitSyncManager import GitSyncManager\nfrom SiemplifyJob import SiemplifyJob\nfrom SiemplifyUtils import output_handler\n\nSCRIPT_NAME = \"Pull Playbook\"\n\n\n@output_handler\ndef main():\n    siemplify = SiemplifyJob()\n    siemplify.script_name = SCRIPT_NAME\n\n    pull_whitelist = list(\n        [\n            _f\n            for _f in [\n                x.strip()\n                for x in siemplify.extract_job_param(\"Playbook Whitelist\", \" \").split(\n                    \",\"\n                )\n            ]\n            if _f\n        ]\n    )\n    include_blocks = siemplify.extract_job_param(\n        \"Include Playbook Blocks\", input_type=bool\n    )\n\n    try:\n        gitsync = GitSyncManager.from_siemplify_object(siemplify)\n\n        playbooks = {}\n        for playbook_name in pull_whitelist:\n            siemplify.LOGGER.info(f\"Pulling {playbook_name}\")\n            playbook = gitsync.content.get_playbook(playbook_name)\n            if not playbook:\n                siemplify.LOGGER.info(f\"{playbook_name} not found in the repository\")\n                continue\n            playbooks[playbook.name] = playbook\n            if include_blocks:\n                for block in playbook.get_involved_blocks():\n                    if block.get(\"name\") not in playbooks:\n                        block = gitsync.content.get_playbook(block.get(\"name\"))\n                        if block:\n                            playbooks[block.name] = block\n\n        gitsync.install_workflows(list(playbooks.values()))\n\n    except Exception as e:\n        siemplify.LOGGER.error(f\"General error performing Job {SCRIPT_NAME}\")\n        siemplify.LOGGER.exception(e)\n        raise\n\n    siemplify.end_script()\n\n\nif __name__ == \"__main__\":\n    main()\n","Creator":"Admin","RunIntervalInSeconds":900,"Description":"Pulls and Installs a playbook or block from the repo. NOTE: Please verify you're not overwriting existing playbooks","IsEnabled":true,"IsCustom":true,"Version":1,"IsSystem":false,"Parameters":[{"JobDefinitionId":132,"IsMandatory":false,"DefaultValue":null,"Description":"Optional parameter to override the one found in the integration instance","Name":"Repo URL","Type":2},{"JobDefinitionId":132,"IsMandatory":false,"DefaultValue":null,"Description":"Optional parameter to override the one found in the integration instance","Name":"Branch","Type":2},{"JobDefinitionId":132,"IsMandatory":true,"DefaultValue":"","Description":"List of playbook names, separated by a comma, to pull from the repo","Name":"Playbook Whitelist","Type":2},{"JobDefinitionId":132,"IsMandatory":false,"DefaultValue":"true","Description":"Pull playbooks involved blocks. To force a link between playbooks and blocks, Set this flag to True and specify only the playbook name in the list","Name":"Include Playbook Blocks","Type":0}],"PythonVersion":"None"}