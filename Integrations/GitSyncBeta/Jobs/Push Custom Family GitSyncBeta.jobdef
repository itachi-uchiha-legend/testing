{"Name":"Push Custom Family GitSyncBeta","Integration":"GitSyncBeta","Script":"from GitSyncManager import GitSyncManager\nfrom SiemplifyJob import SiemplifyJob\nfrom SiemplifyUtils import output_handler\nfrom definitions import VisualFamily\n\nSCRIPT_NAME = \"Push Custom Family\"\n\n\n@output_handler\ndef main():\n    siemplify = SiemplifyJob()\n    siemplify.script_name = SCRIPT_NAME\n\n    commit_msg = siemplify.extract_job_param(\"Commit\")\n    family_names = list(\n        [\n            _f\n            for _f in [\n                x.strip()\n                for x in siemplify.extract_job_param(\"Family Name\", \" \").split(\",\")\n            ]\n            if _f\n        ]\n    )\n    readme_addon = siemplify.extract_job_param(\"Readme Addon\", input_type=str)\n\n    try:\n        gitsync = GitSyncManager.from_siemplify_object(siemplify)\n\n        for visualFamily in gitsync.api.get_custom_families():\n            if visualFamily[\"family\"] in family_names:\n                if readme_addon:\n                    siemplify.LOGGER.info(\n                        \"Readme addon found - adding to GitSync metadata file (GitSync.json)\"\n                    )\n                    gitsync.content.metadata.set_readme_addon(\n                        \"Visual Family\", visualFamily.get(\"family\"), readme_addon\n                    )\n\n                siemplify.LOGGER.info(\n                    f\"Pushing Visual Family - {visualFamily.get('family')}\"\n                )\n                gitsync.content.push_visual_family(\n                    VisualFamily(gitsync.api.get_custom_family(visualFamily[\"id\"]))\n                )\n\n        gitsync.commit_and_push(commit_msg)\n\n    except Exception as e:\n        siemplify.LOGGER.error(f\"General error performing Job {SCRIPT_NAME}\")\n        siemplify.LOGGER.exception(e)\n        raise\n\n\nif __name__ == \"__main__\":\n    main()\n","Creator":"Admin","RunIntervalInSeconds":900,"Description":"Exports a custom family to the repo.","IsEnabled":true,"IsCustom":true,"Version":1,"IsSystem":false,"Parameters":[{"JobDefinitionId":102,"IsMandatory":true,"DefaultValue":"","Description":"Commit message","Name":"Commit","Type":2},{"JobDefinitionId":102,"IsMandatory":false,"DefaultValue":null,"Description":"Optional parameter to override the one found in the integration instance","Name":"Repo URL","Type":2},{"JobDefinitionId":102,"IsMandatory":false,"DefaultValue":null,"Description":"Optional parameter to override the one found in the integration instance","Name":"Branch","Type":2},{"JobDefinitionId":102,"IsMandatory":false,"DefaultValue":"","Description":"Optional parameter to override the one found in the integration instance","Name":"Commit Author","Type":2},{"JobDefinitionId":102,"IsMandatory":true,"DefaultValue":"","Description":"Name of the visual family to push to the repo","Name":"Family Name","Type":2},{"JobDefinitionId":102,"IsMandatory":false,"DefaultValue":"","Description":"Appends markdown to the end of the readme file of all custom families pushed this run","Name":"Readme Addon","Type":2}],"PythonVersion":"None"}